<?php
session_start();
require "includes/header.php";
require "Database/connection.php";




$sql = "SELECT * FROM category";
$resulting = mysqli_query($conn, $sql);

// ---------------   dedline scene here   ---------------------------

$sql_deadline = "SELECT * FROM jobs WHERE admin_status = 'Approved' ";
$sql_deadline_run = mysqli_query($conn, $sql_deadline);
$deadline = mysqli_fetch_array($sql_deadline_run);


// ---------------  END  dedline scene here   ---------------------------

// counting , how much jobs are posted 
$sql = "SELECT COUNT(*) AS total FROM jobs WHERE admin_status = 'Approved'";
$result = mysqli_query($conn, $sql);
$row = mysqli_fetch_assoc($result);
$JobCounts = $row['total'];

?>

<!-- ***** Preloader Start ***** -->
<div id="preloader">
  <div class="jumper">
    <div></div>
    <div></div>
    <div></div>
  </div>
</div>
<!-- ***** Preloader End ***** -->


<?php require "includes/navbar.php"; ?>

<!-- Page Content -->
<div class="page-heading about-heading header-text" style="background-image: url('images/des.jpg'); ">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <form id="search-form">
          <div class="search-bar mt-5 container d-flex align-items-center">
            <!-- <input type="text" class="form-control p-3 extra-padding" id="job-search" name="job-search" placeholder="I'm Looking for .... (Eg: job title)" style="border-radius: 25px; font-size:20px;"> -->
            &nbsp;&nbsp;&nbsp;
            <!-- <button type="submit" class="btn btn-primary p-4" style="border-radius: 50px;"> -->
            <!-- <i class="fas fa-search ml-2" style="font-size: 50px;"></i> -->
            <!-- </button> -->
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="products">
  <div class="container">
    <div class="row">
      <div class="col-md-3">
        <div class="contact-form">
          <form id="filter-form">
            <h5 style="margin-bottom: 15px">Type</h5>

            <div>
              <label>
                <input type="checkbox" class="filter-checkbox" name="type" value="Part-time">
                <small>Part time (5)</small>
              </label>
            </div>

            <div>
              <label>
                <input type="checkbox" class="filter-checkbox" name="type" value="Full-time">
                <small>Full time (5)</small>
              </label>
            </div>

            <div>
              <label>
                <input type="checkbox" class="filter-checkbox" name="type" value="Internship">
                <small>Internship (5)</small>
              </label>
            </div>

            <br>

            <h5 style="margin-bottom: 15px">Category</h5>

            <div>
              <?php

              if (mysqli_num_rows($resulting) > 0) {
                // Loop through each category and create a checkbox for each
                while ($row = mysqli_fetch_assoc($resulting)) {
                  echo '<label>';
                  echo '<input type="checkbox" class="filter-checkbox" name="category" value="' . $row['category_name'] . '">';
                  echo '  ';
                  echo '<small>' . $row['category_name'] . ' Jobs</small>';
                  echo '</label>';
                  echo '<br>';
                }
              }
              ?>
            </div>

            <!-- Add more categories as needed -->

            <br>

            <h5 style="margin-bottom: 15px">Career levels</h5>

            <div>
              <label>
                <input type="checkbox" class="filter-checkbox" name="career" value="Entry_Level">
                <small>Entry Level</small>
              </label>
            </div>

            <div>
              <label>
                <input type="checkbox" class="filter-checkbox" name="career" value="Mid_Level">
                <small>Mid Level</small>
              </label>
            </div>

            <br>

            <h5 style="margin-bottom: 15px">Education levels</h5>

            <div>
              <label>
                <input type="checkbox" class="filter-checkbox" name="education" value="Degree">
                <small>Degree (5)</small>
              </label>
            </div>

            <div>
              <label>
                <input type="checkbox" class="filter-checkbox" name="education" value="High School">
                <small>High School (5)</small>
              </label>
            </div>
          </form>

        </div>
      </div>



      <div class="col-md-9">
        <div class="row asas">
          <div class="col-md-12">
            <h5 class="text-muted text-center p-3 shadow" style=" border-radius: 15px;"><?= $JobCounts ?> Jobs are Found
            </h5>
          </div>

          <!-- Job Listings -->
          <div id="search-results" class="row">
            <!-- Job results will be displayed here -->
            <?php
            // Define the number of results per page
            $results_per_page = 4;

            // Get the current page number
            if (!isset($_GET['page'])) {
              $page = 1;
            } else {
              $page = $_GET['page'];
            }

            // Calculate the SQL LIMIT clause starting number for the results on the current page
            $offset = ($page - 1) * $results_per_page;

            $sql = "SELECT * FROM jobs WHERE admin_status = 'Approved' LIMIT $offset, $results_per_page";
            $sql_run = mysqli_query($conn, $sql);
            if ($sql_run->num_rows > 0) {
              while ($row = mysqli_fetch_array($sql_run)) {
                ?>

                <div class="col-md-12 mb-4 hoverEffect">
                  <a href="job-details?id=<?= $row['id']; ?>" style="text-decoration: none; color: inherit;">
                    <div class="card shadow">
                      <div class="card-body">
                        <div class="row ">
                          <div class="col-md-4 d-flex align-items-center justify-content-center">
                            <!-- Image -->
                            <img src="Admin/uploads/<?= $row['company_logo']; ?>" alt="Image" class="img-fluid"
                              style="max-width:150px;border-radius: 20px;">
                          </div>
                          <div class="col-md-5 d-flex align-items-center">
                            <div>
                              <!-- Name and company -->
                              <h4 class="chakra-petch-bold"><?= $row['job_title'] ?></h4>
                              <p><?= $row['job_category'] ?></p>
                              <!-- Location -->
                              <p> <i class="fas fa-map-marker-alt" style="font-size: 15px;"> <?= $row['location'] ?></i></p>
                            </div>
                          </div>
                          <div class="col-md-3 d-flex align-items-center">
                            <div>
                              <!-- Salary -->
                              <i class="fas fa-dollar-sign" style="font-size: 15px;"> &nbsp;<?= $row['salary_range'] ?></i>
                              <!-- Employment Type -->
                              <p><i class="fas fa-briefcase" style="font-size: 15px;"></i>
                                &nbsp; &nbsp; <?= $row['employment_type'] ?></p>
                              <!-- Application Deadline -->
                              <i class="" style="font-size: 15px;"> &nbsp;<?= $row['application_deadline'] ?></i>


                              <?php
                              // Assuming $row['application_deadline'] contains the deadline date
                              $application_deadline = $row['application_deadline'];

                              // Get the current date
                              $current_date = date('Y-m-d');

                              // Convert dates to DateTime objects
                              $deadline_date = new DateTime($application_deadline);
                              $current_date = new DateTime($current_date);

                              // Calculate the difference
                              $interval = $current_date->diff($deadline_date);

                              // Get the number of days remaining
                              $days_remaining = $interval->days;

                              // Display the number of days remaining
                              if ($current_date > $deadline_date) {
                                // echo "<i class='' style='font-size: 15px;'>Deadline has passed</i>";
                                ?>
                                <span class="badge badge-danger"> Application closed</span>
                                <?php
                              } else {
                                // echo "<i class='' style='font-size: 15px;'>{$days_remaining} days remaining</i>";
                                ?>
                                <span class="badge badge-info"><?= $days_remaining ?> Left</span>
                                <?php

                              }
                              ?>



                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </a>
                </div>



                <?php
              }
            }

            // Pagination links
            $sql = "SELECT COUNT(*) AS total FROM jobs";
            $result = mysqli_query($conn, $sql);
            $row = mysqli_fetch_assoc($result);
            $total_pages = ceil($row['total'] / $results_per_page);

            echo '<nav aria-label="Page navigation">';
            echo '<ul class="pagination justify-content-center">';
            for ($i = 1; $i <= $total_pages; $i++) {
              echo '<li class="page-item"><a class="page-link" href="?page=' . $i . '">' . $i . '</a></li>';
            }
            echo '</ul>';
            echo '</nav>';
            ?>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


</div>
</div>
</div>




<?php include ("includes/footer.php") ?>



<!-- Bootstrap core JavaScript -->
<script
  src="https://demo.phpjabbers.com/free-web-templates/job-website-template-138/vendor/jquery/jquery.min.js"></script>
<script
  src="https://demo.phpjabbers.com/free-web-templates/job-website-template-138/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>


<!-- Additional Scripts -->
<script src="https://demo.phpjabbers.com/free-web-templates/job-website-template-138/assets/js/custom.js"></script>
<script src="https://demo.phpjabbers.com/free-web-templates/job-website-template-138/assets/js/owl.js"></script>
</body>


<!-- Mirrored from demo.phpjabbers.com/free-web-templates/job-website-template-138/jobs.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 13 May 2024 08:12:56 GMT -->

</html>















<script>
  <?php

  // messages from corect or not 
  
  if (isset($_SESSION['message'])) {
    ?>
      alertify.set('notifier', 'position', 'bottom-right');
      alertify.success('<?= $_SESSION['message'] ?>');
    <?php
    unset($_SESSION['message']);
  }
  ?>
 </script>
 

<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  $(document).ready(function() {
    $('.filter-checkbox').on('change', function() {
      filterJobs();
    });
 
    function filterJobs() {
      let types = [];
      let categories = [];
       let careers = [];
      let educations = [];

      $('input[name="type"]:checked').each(function()  {
        types.push($(this).val());
      });

      $('input[name="category"]:checked').each(function( ) {
        categories.push($(this).val());
      });

      $('input[name="career"]:checked').each(function() {
        careers.push($(this).val());
      });

      $('input[name="education"]:checked').each(function() {
        educations.push($(this).val());
      });

      $.ajax({
        url: 'filter.php' ,
        method: 'GET',
        data: {
          type: types,
          category: categories, 
          career: careers,
          education: educations
        },
        success: function(response) {
          $('#search-results').empty();
          let jobs = JSON.parse(response);

          jobs.forEach(function(job) {
            let jobHtml = `
                        <div class="col-md-12 mb-4 hoverEffect">
                        <a href="job-details?id=${job.id}" style="text-decoration: none; color: inherit;">
                        
                            <div class="card shadow">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-4 d-flex align-items-center justify-content-center">
                                            <img src="Admin/uploads/${job.company_logo}" alt="Image" class="img-fluid" style="max-width:150px;border-radius: 20px;">
                                        </div>
                                        <div class="col-md-6 d-flex align-items-center">
                                            <div>
                                                <h4 class="chakra-petch-bold">${job.job_title}</h4>
                                                <p>${job.job_category}</p>
                                                <p><i class="fas fa-map-marker-alt" style="font-size: 15px;"> ${job.location}</i></p>
                                            </div>
                                        </div>
                                        <div class="col-md-2 d-flex align-items-center">
                                            <div>
                                                <i class="fas fa-dollar-sign" style="font-size: 15px;"> &nbsp;${job.salary_range}</i>
                                                <p><i class="fas fa-briefcase" style="font-size: 15px;"></i> &nbsp; &nbsp; ${job.employment_type}</p>
                                                <i class="" style="font-size: 15px;"> &nbsp;${job.application_deadline}</i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </a>
                        </div>`;
            $('#search-results').append(jobHtml);
          });
        }
      });
    }
  });
</script>